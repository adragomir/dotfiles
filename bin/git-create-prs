#!/bin/bash
branch_name="$(git rev-parse --symbolic-full-name --abbrev-ref HEAD)"
IFS=$'\r\n'
commits=($(git rev-list --reverse "master..${branch_name}"))

#base=$(git rev-parse master)
base=master

commits_len=${#commits[@]}

for (( i=0; i<=$(( $commits_len -1 )); i++ ))
do
  commit_msg=$(git log -1 --pretty=format:%s "${commits[$i]}")
  issue_name=`expr "$commit_msg" : '^\[\([A-Z0-9\-]*\)\]'`
  echo "git push origin ${commits[$i]}:refs/heads/$issue_name"
  echo "hub pull-request -b $base -h $issue_name"
  base=$issue_name
done

