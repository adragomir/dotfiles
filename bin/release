#!/bin/bash

from=$1
version=$2

bn=$(basename $from)
if [[ $version =~ ^[0-9] ]]; then
  version="${bn}-$version"
fi

dir=$(mktemp -d -t release)
mkdir -p $dir/$version
cp -a $from/* $dir/$version
rm -rf $dir/$version/.git
here=$(pwd)

pushd $dir &>/dev/null
if [[ $3 == "zip" ]]; then
  zip -r $version.zip $version
  output=$version.zip
else
  tar zcf $version.tar.gz $version
  output=$version.tar.gz
fi
popd &>/dev/null
cp $dir/$output .

rm -rf $dir
aws s3 cp $output s3://saasbase-repo/${bn}/$output
rm -rf $output

