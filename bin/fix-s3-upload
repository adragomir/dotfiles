#!/bin/bash

host=$1
file=$2

if [[ ! -z $host && ! -z $file ]]; then
  bucket=$(echo $file | sed 's/s3:\/\/\([^\/]*\)\/\(.*\)$/\1/')
  echo $bucket
  key=$(echo $file | sed 's/s3:\/\/\([^\/]*\)\/\(.*\)$/\2/')
  echo $key
  filename=$(basename $key)
  echo $filename
  ssh $host "AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY aws s3 cp $file ."
  ssh $host "AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY aws s3 rm $file"
  ssh $host "AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY aws s3api put-object --bucket $bucket --key $key --body $filename"
fi
